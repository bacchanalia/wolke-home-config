#!/usr/bin/perl
use strict;
use warnings;

sub isMountpoint($);

sub main(@){
  my $src = "/media/videos";
  my $dest = "/media/BACKUP_VIDEOS";

  die "$src is not a mountpoint\n" if not isMountpoint $src;
  die "$dest is not a mountpoint\n" if not isMountpoint $dest;

  my @cmd = qw(sudo rsync -avP --del /media/videos/ /media/BACKUP_VIDEOS/);
  print "@cmd\n";
  exec @cmd;
}

sub isMountpoint($){
  system "mountpoint '$_[0]' >/dev/null 2>/dev/null";
  return $? == 0;
}

&main(@ARGV);
