#!/usr/bin/perl
use strict;
use warnings;

#my $arch = `uname -i`;
#chomp $arch;
#my $ghcVersion = "7.0.4";
#my $hpVersion = "2011.4.0.0";

#my $ghcDir = "ghc-$ghcVersion";
#my $ghcTar = "ghc-$ghcVersion-$arch-unknown-linux.tar.bz2";
#my $ghcUrl = "http://haskell.org/ghc/dist/$ghcVersion/$ghcTar";

#my $hpDir = "haskell-platform-$hpVersion";
#my $hpTar = "haskell-platform-$hpVersion.tar.gz";
#my $hpUrl = "http://lambda.haskell.org/platform/download/$hpVersion/$hpTar";

print "\n\nInstall ghc and haskell platform (y/N)? ";
if(lc <STDIN> eq "y\n"){
  system "sudo apt-get install ghc haskell-platform";
#  system "sudo apt-get remove .*libghc.*";
#  system "sudo apt-get install"
#    . " dctrl-tools devscripts docbook-xsl"
#    . " libbsd-dev libffi-dev libgmp-dev"
#    . " libgmpxx4ldbl xsltproc libgmp3c2"
#    ;

#  chdir "/tmp";
#  system "wget $ghcUrl";
#  system "tar -xf $ghcTar";
#  chdir "/tmp/$ghcDir";
#  system "./configure --prefix=/usr";
#  system "sudo make install";

#  chdir "/tmp";
#  system "wget $hpUrl";
#  system "tar -xf $hpTar";
#  chdir "/tmp/$hpDir";
#  system "./configure --enable-unsupported-ghc-version";
#  system "make";
#  system "sudo make install";
  
#  system "rm -rf \$HOME/.cabal";
#  system "cabal update";
}


print "Install xmonad, dzen, and other cabal packages (y/N)? ";
if(lc <STDIN> eq "y\n"){
  system "\$HOME/bin/install-dzen2";
  
  my @xmonadDeps = qw(
    cdbs dctrl-tools fdupes html-xml-utils intltool libexpat1-dev libffi-dev
    libfontconfig1-dev libfreetype6-dev libxft-dev libxinerama-dev libxrender-dev
    python-scour x11proto-render-dev x11proto-xinerama-dev xutils-dev
  );
  print "xmonad deps: " . (join @xmonadDeps, ' ') . "\n";
  system "sudo apt-get install " . (join @xmonadDeps, ' ');
  

  #cp the %-named files in .xmonad to its place
  for my $file (`ls \$HOME/.xmonad/%*`){
    chomp $file;
    my $loc = $file;
    $loc =~ s/^[^%]*%/%/;
    $loc =~ s/%/\//g;
    system "sudo cp $file $loc";
  }

  my @cabalPackages = qw(
    runghc
    xmonad xmonad-contrib
    taffybar
    regex-pcre-builtin unixutils utf8-string monad-loops

    cmdargs pureMD5 transformers tagged semigroups data-default dlist entropy
    cereal X11 syb binary largeword posix-timer split
  );
  system "cabal update";
  system "cabal install --reinstall " . join ' ', @cabalPackages;
}
