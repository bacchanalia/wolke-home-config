#!/usr/bin/perl
use strict;
use warnings;

my $file = "$ENV{HOME}/.xmonad/lib/Bindings.hs";
my @out = split /\n/, `runghc -main-is $file`;
print join "\n", @out;

my $height = 41;

my @cols;
my $col = [];
for (my $i=0; $i<@out; $i++){
  push @$col, $out[$i];
  if(($i > 0 and $i % ($height-1) == 0) or $i == $#out){
    push @cols, $col;
    $col = [];
  }
}

my @maxCols;
for my $col(@cols){
  my $max=0;
  for my $i(@$col){
    chomp $i;
    $max = length $i if length $i > $max;
  }
  push @maxCols, $max;
}

my $dzenOut = " \n";
for(my $i=0; $i<$height; $i++){
  for(my $c=0; $c<@cols; $c++){
    my $max = $maxCols[$c];
    my $kb = ${$cols[$c]}[$i];
    $kb .= ' ' x ($max - length $kb);
    $dzenOut .= "$kb | ";
  }
  $dzenOut .= "\n";
}

open DZEN, "| dzen2 -fn Inconsolata-14 -x 0 -y 0 -p -expand left -l $height -e 'onstart=uncollapse;button1=exit;button2=exit;button3=exit'";
print DZEN $dzenOut;
close DZEN;
