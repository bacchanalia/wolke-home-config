#!/usr/bin/perl
use strict;
use warnings;

my $arg = shift() || 'get';
if($arg !~ /^(get|on|off|toggle)$/ or @ARGV > 0){
  die "Usage: $0 get|on|off|toggle\n";
}

my $btAcpiDev = '/proc/acpi/ibm/bluetooth';

my $state = 'unknown';
if(`cat $btAcpiDev` =~ /status:\s*(enabled|disabled)/){
  $state = $1;
}
if($arg eq 'get'){
  print "bluetooth is $state\n";
}else{
  $arg = $state eq 'enabled' ? 'on' : 'off' if $arg eq 'toggle';

  my $val = $arg eq 'on' ? 'enable' : 'disable';
  open FH, "| sudo tee $btAcpiDev";
  print FH "$val\n";
  close FH;
}
