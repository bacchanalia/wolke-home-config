#!/usr/bin/perl
use strict;
use warnings;
use IO::Handle;

my $arg = shift;
my $rbox = `echo -n \$HOME/.dzen2/printers/rbox`;
if(fork){
  while(readline STDIN){
    system "rc --next";
  }
  exit 0;
}

while(1){
  my $out = `$rbox`;
  my $sep = '#%#%#%#';
  $out =~ s/\^[a-z]+\([^)]*\)/$sep/g;
  $out =~ s/($sep)+/$sep/g;
  $out =~ s/^$sep//;
  $out =~ s/$sep$//;
  if($out =~ /([0-9:]+)-(.*)$sep([0-9:]+)-(.*)/){
    my $e = $3;
    my $t = $1;
    $e = ' ' x (length($t) - length($e)) . $e;
    $t = ' ' x (length($e) - length($t)) . $t;
    $out = "$e / $t $2 :: $4\n";
  }else{
    $out =~ s/$sep/ /g;
  }
  print $out;
  sleep 1;
}
