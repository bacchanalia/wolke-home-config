#!/usr/bin/perl
use strict;
use warnings;

my $port = '5900';

my @server = (
  "x11vnc",
    "-safer", "-localhost", "-nopw", "-once",
    "-display", ":0",
);
my @client = (
  "vncviewer",
    "localhost:0",
    "-quality", "0",
    "-compresslevel", "1",
);
my @sshBind = (
  "ssh", "-f",
    "-L", "$port:localhost:$port",
);

sub main(@){
  my $host = shift();
  die "Usage: $0 host" if not defined $host;

  system @sshBind, $host, "@server";
  exit $? if $? != 0;

  sleep 5;

  system @client;
}

&main(@ARGV);
