#!/usr/bin/perl
use strict;
use warnings;


my $pl_file = '/home/wolke/.local/share/rhythmbox/playlists.xml';
my $now = time();
system "cp $pl_file $pl_file.$now.bak";


#Takes a filename and returns the content as a large string
sub slurp($){
	my $infile = shift;
	local($/, *INFH);
	open INFH, $infile or
		die "Error opening $infile for reading\n";
	my $content = <INFH>;
	close INFH;
	return $content;
}

sub writeFile($$){
  my $fname = shift;
  my $content = shift;
  open OUTFH,  "> $fname" or die "trying to open $fname for writing";
  print OUTFH $content;
}



my $pl_name = shift;

my @files;

while(my $file = <STDIN>){
  chomp $file;
  push @files, $file;
}

my $opt = shift;
if($opt eq '--sort'){
  @files = sort @files;
}

my $pl = "  <playlist name=\"$pl_name\" type=\"static\">\n";
for my $file(@files){
  $file = `echo $file | filename2url`;
  chomp $file;
  $pl .= "    <location>$file</location>\n";
}
$pl .= "  </playlist>\n";


my $content = slurp $pl_file;
$content =~ s/(<\/rhythmdb-playlists>)/$pl$1/;

writeFile $pl_file, $content;

