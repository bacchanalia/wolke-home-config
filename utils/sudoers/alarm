#!/usr/bin/perl
use strict;
use warnings;

my $alarm = '/usr/share/alarm';

die "Usage:
  $0     - runs 'mplayer $alarm'
           reruns as the user running pulseaudio if run as root
";

my $pulseUser = `ps --no-heading -o user -C pulseaudio`;
$pulseUser =~ s/\n.*//s; #first line only

my $currentUser = `whoami`;
chomp $currentUser;

if($currentUser eq $pulseUser){
  system "term", "mplayer", $alarm;
}elsif($currentUser eq 'root'){
  print "rerunning as pulse user $pulseUser\n";
  system "su", $pulseUser, "-c", "$0 @ARGV";
}
