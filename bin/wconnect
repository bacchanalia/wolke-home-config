#!/usr/bin/perl
use strict;
use warnings;

my $ssid = shift;
my $key = shift;
my $dev = `wlan`;
chomp $dev;

sub systemp(@){
  print join(' ', @_) . "\n";
  system @_;
}

my $lcssid = lc $ssid;

systemp "sudo ifconfig $dev up";
systemp "sudo iwconfig $dev essid $ssid key $key";
systemp "sudo wpa_supplicant -Dwext -i$dev -c\$HOME/wifi/$lcssid.conf &";
sleep 1;
systemp "sudo \$HOME/bin/resolvchooser google";
systemp "sudo dhclient -d $dev &";
