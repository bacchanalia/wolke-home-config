#!/usr/bin/perl
use strict;
use warnings;

my $in = shift;
my $out = shift;
my $start = shift;
my $end = shift;

if(@ARGV > 0 or not defined $in or not defined $out){
  die "Usage: $0 IN OUT [START] [END]
         IN:  audio or video file input to mplayer
         OUT: wav file output
         START: argument to -ss, if given.   e.g.: 1:35, 95.2, etc.
         END: argument to -endpos, if given. e.g.: 1:35, 95.2, etc.\n";
}

$out =~ s/,/\\,/g;
my @cmd = (
  "mplayer", "-quiet", $in,
  "-ao", "pcm:fast:file=$out",
  "-vc", "dummy",
  "-vo", "null",
  "-channels", "2"
  );
if(defined $start and $start ne ''){
  push @cmd, '-ss';
  push @cmd, $start;
}
if(defined $end and $end ne ''){
  push @cmd, '-endpos';
  push @cmd, $end;
}

print join ' ', @cmd;
print "\n";
system @cmd;
