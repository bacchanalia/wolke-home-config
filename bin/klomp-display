#!/usr/bin/perl
use strict;
use warnings;

sub run(@);

sub main(@){
  my $arg = "--toggle";
  $arg = shift if @_ == 1;
  die "Usage: $0 [--on|--off|--toggle]  {default is --toggle}\n" if @_ != 0;

  if($arg eq "--toggle"){
    system "pkill", "-0", "klomplayer";
    $arg = ($? == 0) ? "off" : "on";
  }

  if($arg eq "--off"){
    run "klomp-cmd", "stop";
    run "pkill", "-9", "-f", "klomp-lcd";
    run "pi lcd --off";
  }elsif($arg eq "--on"){
    run "klomp-mnt";
    run "pkill", "-9", "-f", "klomp-lcd";
    run "pi lcd --on";
    run "nohup klomp-lcd --ipmagic=raspi >/dev/null 2>/dev/null &";
    run "klomp-cmd", "start";
  }
}

sub run(@){
  print "@_\n";
  system @_;
}

&main(@ARGV);
